{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome to the Embedded Sharepoint Documentation","text":"<p>Welcome to the Embedded Sharepoint! Embedded-Sharepoint contains the shared embedded files to build and develop for our custom STM32 PCBs.</p>"},{"location":"#getting-started","title":"Getting Started","text":""},{"location":"#directory-structure","title":"Directory Structure","text":""},{"location":"#command-usage","title":"Command Usage","text":""},{"location":"#running-tests","title":"Running tests","text":""},{"location":"#adding-sharepoint-to-your-project","title":"Adding Sharepoint To Your Project","text":"<p>Embedded-Sharepoint contains common files so it should be stored as a submodule inside your repository.  </p>"},{"location":"#examples","title":"Examples:","text":"<ul> <li>BPS-Leader</li> <li>Active-Precharge Board</li> </ul>"},{"location":"#contributing","title":"Contributing","text":""},{"location":"#wsl","title":"WSL","text":""},{"location":"#usb-passthrough","title":"USB PassThrough","text":""},{"location":"#pass-usb-devices","title":"Pass USB Devices","text":"<p>In PowerShell administrator: </p> <pre><code>usbipd list\nusbipd bind --busid &lt;busid&gt;\nusbipd attach --wsl --busid &lt;busid&gt;\n</code></pre>"},{"location":"#porting","title":"Porting","text":"<p>A valid port of an STM requires three things:</p> <ol> <li>A directory under stm/stm32f4xx or stm/stm32l4xx must be generated with the generic name of the microcontroller. This is typically stm32 followed by four characters specifying the series and line (stm32f413, stm32l431, etc.)</li> <li>A linker script under the aforementioned directory. This can be autogenerated by STM32CubeMX or grabbed from the internet. The name should take the form of STM32*_FLASH.ld, and should include the full name of the processor (STM32F413RHTx_FLASH.ld, STM32L431CBTx_FLASH.ld, etc.)</li> <li>A startup assembly file including the vector table and some basic handlers (most important being Reset_Handler). This can be autogenerated by STM32CubeMX or grabbed from the internet. The name should take the form of startup_stm32 followed by the four characters specifying the series and line and then xx (startup_stm32f413xx.s, startup_stm32l431xx.s)</li> </ol> <p>The Makefile will expect this exact naming structure, so please ensure you've set it up properly. If everything goes to plan, you should be able to build with PROJECT_TARGET set to the full name of the port.</p>"},{"location":"DBC/","title":"Table of Contents","text":"<ul> <li>Bps (daybreak)</li> <li>Contactor</li> <li>Controls</li> <li>Prohelion Wavesculptor22</li> <li>Tpee Mppt[a]</li> <li>Tpee Mppt[b]</li> </ul>"},{"location":"DBC/#bps-daybreakdbc","title":"bps (Daybreak).dbc","text":"<p>GitHub Link</p>"},{"location":"DBC/#messages","title":"Messages","text":"ID Name DLC Signals 0x2 BPS_Trip 1 BPS_Trip 0x101 BPS_All_Clea 1 BPS_All_Clear 0x102 BPS_Contactor_State 1 HV_Contactor, Array_Contactor 0x103 BPS_Current 4 Current 0x104 BPS_Voltage_Array 5 Voltage_idx, Voltage_Value 0x105 BPS_Temperature_Array 5 Temperature_idx, Temperature_Value 0x106 BPS_SOC 4 SoC 0x107 BPS_WDog_Trigger 1 WDog_Trig 0x108 BPS_CAN_Error 1 BPS_CAN_Error 0x109 BPS_Command 8 BPS_Command 0x10B BPS_Supplemental_Voltage 2 Supplemental_Voltage 0x10C BPS_Charge_Enabled 1 Charge_Enabled 0x10D BPS_Voltage_Summary 8 Pack_Voltage, Voltage_Range, Voltage_Timestamp 0x10E BPS_Temperature_Summary 8 Average_Temp, Temperature_Range, Temperature_Timestamp 0x10F BPS_Fault_State 1 BPS_Fault_State"},{"location":"DBC/#signals","title":"Signals","text":"Name Message Bits [start:end] Length Factor Offset Min Max Unit BPS_Trip BPS_Trip [0:0] 1 1 0 0 1 BPS_All_Clear BPS_All_Clea [0:0] 1 1 0 0 1 HV_Contactor BPS_Contactor_State [2:2] 1 1 0 0 1 Array_Contactor BPS_Contactor_State [0:0] 1 1 0 0 1 Current BPS_Current [0:31] 32 1 0 -20000 100000 mA Voltage_idx BPS_Voltage_Array [0:7] 8 1 0 0 31 Voltage_Value BPS_Voltage_Array [8:39] 32 1 0 0 1000000 mV Temperature_idx BPS_Temperature_Array [0:7] 8 1 0 0 31 Temperature_Value BPS_Temperature_Array [8:39] 32 1 0 0 1000000 mC SoC BPS_SOC [0:31] 32 1 0 0 100 % WDog_Trig BPS_WDog_Trigger [0:0] 1 1 0 0 1 BPS_CAN_Error BPS_CAN_Error [0:0] 1 1 0 0 1 BPS_Command BPS_Command [0:31] 32 1 0 None None Supplemental_Voltage BPS_Supplemental_Voltage [0:15] 16 1 0 0 65535 mV Charge_Enabled BPS_Charge_Enabled [0:0] 1 1 0 0 1 Pack_Voltage BPS_Voltage_Summary [0:23] 24 1 0 0 16777215 mV Voltage_Range BPS_Voltage_Summary [24:47] 24 1 0 0 16777215 mV Voltage_Timestamp BPS_Voltage_Summary [48:63] 16 1 0 0 65535 ms Average_Temp BPS_Temperature_Summary [0:23] 24 1 0 None None mC Temperature_Range BPS_Temperature_Summary [24:47] 24 1 0 None None mC Temperature_Timestamp BPS_Temperature_Summary [48:63] 16 1 0 None None ms BPS_Fault_State BPS_Fault_State [0:7] 8 1 0 0 12"},{"location":"DBC/#contactordbc","title":"contactor.dbc","text":"<p>GitHub Link</p>"},{"location":"DBC/#messages_1","title":"Messages","text":"ID Name DLC Signals 0x401 Precharge_Timeout 1 Motor_Precharge_Timeout, Array_Precharge_Timeout 0x400 Contactor_Sense 2 Actual_Motor_Sense, Expected_Motor_Sense, Motor_Sense_Fault, Motor_Precharge_Sense, Expected_Motor_Precharge_Sense, Motor_Precharge_Sense_Fault, Array_Precharge_Sense, Expected_Array_Precharge_Sense, Array_Prechage_Sense_Fault"},{"location":"DBC/#signals_1","title":"Signals","text":"Name Message Bits [start:end] Length Factor Offset Min Max Unit Motor_Precharge_Timeout Precharge_Timeout [0:0] 1 1 0 0 1 Array_Precharge_Timeout Precharge_Timeout [1:1] 1 1 0 None None Actual_Motor_Sense Contactor_Sense [0:0] 1 1 0 0 1 Expected_Motor_Sense Contactor_Sense [1:1] 1 1 0 None None Motor_Sense_Fault Contactor_Sense [2:2] 1 1 0 0 1 Motor_Precharge_Sense Contactor_Sense [3:3] 1 1 0 0 1 Expected_Motor_Precharge_Sense Contactor_Sense [4:4] 1 1 0 0 1 Motor_Precharge_Sense_Fault Contactor_Sense [5:5] 1 1 0 0 1 Array_Precharge_Sense Contactor_Sense [6:6] 1 1 0 0 1 Expected_Array_Precharge_Sense Contactor_Sense [7:7] 1 1 0 0 1 Array_Prechage_Sense_Fault Contactor_Sense [8:8] 1 1 0 0 1"},{"location":"DBC/#controlsdbc","title":"controls.dbc","text":"<p>GitHub Link</p>"},{"location":"DBC/#messages_2","title":"Messages","text":"ID Name DLC Signals 0x581 IO_State 3 Acceleration_Percentage, Brake_Percentage, IGN_Array, IGN_Motor, Regen_SW, Forward_Gear, Reverse_Gear, Cruz_EN, Cruz_Set, Brake_Light 0x583 Controls_Fault 1 Controls_Fault, Motor_Controller_Fault, BPS_Fault, Pedals_Fault, CarCAN_Fault, Internal_Controls_Fault, OS_Fault, Lakshay_Fault 0x584 Motor_Controller_Safe 1 Motor_Safe, Motor_Controller_Error 0x221 Motor_Drive_Command 8 Motor_Velocity_Setpoint, Motor_Current_Setpoint 0x222 Motor_Power_Command 8 Motor_Power_Setpoint 0x585 Pedals_Raw_Voltage 4 Brake_Raw, Accel_Raw"},{"location":"DBC/#signals_2","title":"Signals","text":"Name Message Bits [start:end] Length Factor Offset Min Max Unit Acceleration_Percentage IO_State [0:7] 8 1 0 0 100 Percentage Brake_Percentage IO_State [8:15] 8 1 0 0 100 Percentage the brake is pressed IGN_Array IO_State [16:16] 1 1 0 0 1 Array Ignition On IGN_Motor IO_State [17:17] 1 1 0 0 1 Motor Ignition On Regen_SW IO_State [18:18] 1 1 0 0 1 Regen Switched On Forward_Gear IO_State [19:19] 1 1 0 0 1 Forward switch Reverse_Gear IO_State [20:20] 1 1 0 0 1 Reverse switch Cruz_EN IO_State [21:21] 1 1 0 0 1 Cruise Enable Cruz_Set IO_State [22:22] 1 1 0 0 1 Cruise Set Brake_Light IO_State [23:23] 1 1 0 0 1 Brakelight state Controls_Fault Controls_Fault [0:0] 1 1 0 0 1 Motor_Controller_Fault Controls_Fault [1:1] 1 1 0 0 1 BPS_Fault Controls_Fault [2:2] 1 1 0 0 1 Pedals_Fault Controls_Fault [3:3] 1 1 0 None None CarCAN_Fault Controls_Fault [4:4] 1 1 0 0 1 Internal_Controls_Fault Controls_Fault [5:5] 1 1 0 0 1 OS_Fault Controls_Fault [6:6] 1 1 0 0 1 Lakshay_Fault Controls_Fault [7:7] 1 1 0 0 1 Motor_Safe Motor_Controller_Safe [0:0] 1 1 0 0 1 Motor_Controller_Error Motor_Controller_Safe [1:1] 1 1 0 0 1 Motor_Velocity_Setpoint Motor_Drive_Command [0:31] 32 1 0 None None rpm Motor_Current_Setpoint Motor_Drive_Command [32:63] 32 1 0 None None % Motor_Power_Setpoint Motor_Power_Command [32:63] 32 1 0 None None % Brake_Raw Pedals_Raw_Voltage [0:14] 15 1 0 0 3300 mV Accel_Raw Pedals_Raw_Voltage [16:30] 15 1 0 0 3300 mV"},{"location":"DBC/#prohelion_wavesculptor22dbc","title":"prohelion_wavesculptor22.dbc","text":"<p>GitHub Link</p>"},{"location":"DBC/#messages_3","title":"Messages","text":"ID Name DLC Signals 0x240 IDInfo 8 TritiumID, SerialNumber 0x241 Status 8 LimitOutputVoltagePWM, LimitMotorCurrent, LimitVelocity, LimitBusCurrent, LimitBusVoltageUpper, LimitBusVoltageLower, LimitIpmOrMotorTemp, LimitReserved, ErrorHardwareOverCurrent, ErrorSoftwareOverCurrent, ErrorDcBusOverVoltage, ErrorBadMotorPositionHallSeq, ErrorWatchdogCausedLastReset, ErrorConfigRead, Error15vRailUnderVoltage, ErrorDesaturationFault, ErrorMotorOverSpeed, ErrorReserved, ActiveMotor, TxErrorCount, RxErrorCount 0x242 BusMeasurement 8 BusVoltage, BusCurrent 0x243 VelocityMeasurement 8 MotorVelocity, VehicleVelocity 0x244 PhaseCurrentMeasurement 8 PhaseCurrentB, PhaseCurrentC 0x245 MotorVoltageVectorMeasurement 8 Vq, Vd 0x246 MotorCurrentVectorMeasurement 8 Iq, Id 0x247 BackEMFMeasurementPrediction 8 BEMFq, BEMFd 0x248 VoltageRail15VMeasurement 8 ReservedSupply15V, Supply15V 0x249 VoltageRail3V31V9Measurement 8 Supply1V9, Supply3V3 0x24A Reserved0A 8 Reserved0A0, Reserved0A1 0x24B HeatsinkMotorTempMeasurement 8 MotorTemp, HeatsinkTemp 0x24C DspBoardTempMeasurement 8 DspBoardTemp, ReservedDspBoardTemp 0x24D Reserved0D 8 Reserved0D0, Reserved0D1 0x24E OdometerBusAhMeasurement 8 Odometer, DCBusAh 0x257 SlipSpeedMeasurement 8 SlipSpeed, ReservedSlipSpeed"},{"location":"DBC/#signals_3","title":"Signals","text":"Name Message Bits [start:end] Length Factor Offset Min Max Unit TritiumID IDInfo [0:31] 32 1 0 None None SerialNumber IDInfo [32:63] 32 1 0 None None LimitOutputVoltagePWM Status [0:0] 1 1 0 0 1 On / Off LimitMotorCurrent Status [1:1] 1 1 0 0 1 On / Off LimitVelocity Status [2:2] 1 1 0 0 1 On / Off LimitBusCurrent Status [3:3] 1 1 0 0 1 On / Off LimitBusVoltageUpper Status [4:4] 1 1 0 0 1 On / Off LimitBusVoltageLower Status [5:5] 1 1 0 0 1 On / Off LimitIpmOrMotorTemp Status [6:6] 1 1 0 0 1 On / Off LimitReserved Status [7:15] 9 1 0 0 511 On / Off ErrorHardwareOverCurrent Status [16:16] 1 1 0 0 1 On / Off ErrorSoftwareOverCurrent Status [17:17] 1 1 0 0 1 On / Off ErrorDcBusOverVoltage Status [18:18] 1 1 0 0 1 On / Off ErrorBadMotorPositionHallSeq Status [19:19] 1 1 0 0 1 On / Off ErrorWatchdogCausedLastReset Status [20:20] 1 1 0 0 1 On / Off ErrorConfigRead Status [21:21] 1 1 0 0 1 On / Off Error15vRailUnderVoltage Status [22:22] 1 1 0 0 1 On / Off ErrorDesaturationFault Status [23:23] 1 1 0 0 1 On / Off ErrorMotorOverSpeed Status [24:24] 1 1 0 0 1 On / Off ErrorReserved Status [25:31] 7 1 0 None None On / Off ActiveMotor Status [32:47] 16 1 0 None None TxErrorCount Status [48:55] 8 1 0 None None RxErrorCount Status [56:63] 8 1 0 None None BusVoltage BusMeasurement [0:31] 32 1 0 0 100 V BusCurrent BusMeasurement [32:63] 32 1 0 0 1000 A MotorVelocity VelocityMeasurement [0:31] 32 1 0 None None rpm VehicleVelocity VelocityMeasurement [32:63] 32 2.237 0 None None mph PhaseCurrentB PhaseCurrentMeasurement [0:31] 32 1 0 None None A_rms PhaseCurrentC PhaseCurrentMeasurement [32:63] 32 1 0 None None A_rms Vq MotorVoltageVectorMeasurement [0:31] 32 1 0 None None V Vd MotorVoltageVectorMeasurement [32:63] 32 1 0 None None V Iq MotorCurrentVectorMeasurement [0:31] 32 1 0 None None A Id MotorCurrentVectorMeasurement [32:63] 32 1 0 None None A BEMFq BackEMFMeasurementPrediction [0:31] 32 1 0 None None V BEMFd BackEMFMeasurementPrediction [32:63] 32 1 0 None None V ReservedSupply15V VoltageRail15VMeasurement [0:31] 32 1 0 None None Supply15V VoltageRail15VMeasurement [32:63] 32 1 0 None None V Supply1V9 VoltageRail3V31V9Measurement [0:31] 32 1 0 None None V Supply3V3 VoltageRail3V31V9Measurement [32:63] 32 1 0 None None V Reserved0A0 Reserved0A [0:31] 32 1 0 None None Reserved0A1 Reserved0A [32:63] 32 1 0 None None MotorTemp HeatsinkMotorTempMeasurement [0:31] 32 1 0 None None C HeatsinkTemp HeatsinkMotorTempMeasurement [32:63] 32 1 0 None None C DspBoardTemp DspBoardTempMeasurement [0:31] 32 1 0 None None C ReservedDspBoardTemp DspBoardTempMeasurement [32:63] 32 1 0 None None Reserved0D0 Reserved0D [0:31] 32 1 0 None None Reserved0D1 Reserved0D [32:63] 32 1 0 None None Odometer OdometerBusAhMeasurement [0:31] 32 1 0 None None m DCBusAh OdometerBusAhMeasurement [32:63] 32 1 0 None None Ah SlipSpeed SlipSpeedMeasurement [0:31] 32 1 0 None None Hz ReservedSlipSpeed SlipSpeedMeasurement [32:63] 32 1 0 None None"},{"location":"DBC/#tpee_mpptadbc","title":"tpee_mppt[A].dbc","text":"<p>GitHub Link</p>"},{"location":"DBC/#messages_4","title":"Messages","text":"ID Name DLC Signals 0x201 MPPT_32_0_Status 5 MPPT_Mode, MPPT_Fault, MPPT_Enabled, MPPT_AmbientTemperature, MPPT_HeatsinkTemperature 0x200 MPPT_32_0_Power 8 MPPT_Vin, MPPT_Iin, MPPT_Vout, MPPT_Iout 0x209 MPPT_32_0_SetMode 1 Boost_Enable"},{"location":"DBC/#signals_4","title":"Signals","text":"Name Message Bits [start:end] Length Factor Offset Min Max Unit MPPT_Mode MPPT_32_0_Status [0:7] 8 1 0 None None MPPT_Fault MPPT_32_0_Status [8:15] 8 1 0 None None MPPT_Enabled MPPT_32_0_Status [16:23] 8 1 0 None None MPPT_AmbientTemperature MPPT_32_0_Status [31:38] 8 1 0 -128 127 C MPPT_HeatsinkTemperature MPPT_32_0_Status [39:46] 8 1 0 -128 127 C MPPT_Vin MPPT_32_0_Power [7:22] 16 0.01 0 -327.68 327.67 V MPPT_Iin MPPT_32_0_Power [23:38] 16 0.0005 0 -16.384 16.3835 A MPPT_Vout MPPT_32_0_Power [39:54] 16 0.01 0 -327.68 327.67 V MPPT_Iout MPPT_32_0_Power [55:70] 16 0.0005 0 None None A Boost_Enable MPPT_32_0_SetMode [0:0] 1 1 0 0 1"},{"location":"DBC/#tpee_mpptbdbc","title":"tpee_mppt[B].dbc","text":"<p>GitHub Link</p>"},{"location":"DBC/#messages_5","title":"Messages","text":"ID Name DLC Signals 0x211 MPPT_33_0_Status 5 MPPT_Mode, MPPT_Fault, MPPT_Enabled, MPPT_AmbientTemperature, MPPT_HeatsinkTemperature 0x210 MPPT_33_0_Power 8 MPPT_Vin, MPPT_Iin, MPPT_Vout, MPPT_Iout 0x219 MPPT_33_0_SetMode 1 Boost_Enable"},{"location":"DBC/#signals_5","title":"Signals","text":"Name Message Bits [start:end] Length Factor Offset Min Max Unit MPPT_Mode MPPT_33_0_Status [0:7] 8 1 0 None None MPPT_Fault MPPT_33_0_Status [8:15] 8 1 0 None None MPPT_Enabled MPPT_33_0_Status [16:23] 8 1 0 None None MPPT_AmbientTemperature MPPT_33_0_Status [31:38] 8 1 0 -128 127 C MPPT_HeatsinkTemperature MPPT_33_0_Status [39:46] 8 1 0 -128 127 C MPPT_Vin MPPT_33_0_Power [7:22] 16 0.01 0 -327.68 327.67 V MPPT_Iin MPPT_33_0_Power [23:38] 16 0.0005 0 -16.384 16.3835 A MPPT_Vout MPPT_33_0_Power [39:54] 16 0.01 0 -327.68 327.67 V MPPT_Iout MPPT_33_0_Power [55:70] 16 0.0005 0 None None A Boost_Enable MPPT_33_0_SetMode [0:0] 1 1 0 0 1"},{"location":"Installation/","title":"Installation Instructions","text":"<p>Development for Embedded-Sharepoint requires a linux-based environment. Running linux natively yields the best results, but there are workarounds through nix on Mac OS or Windows Subsystem for Linux (WSL) on Windows.  </p> <p>Please ensure you've done the following before moving on: Install Visual Studio Code</p>"},{"location":"Installation/#linux","title":"Linux","text":"<p>Thanks for making our lives easy :)    </p> <ol> <li>Follow the instructions here to create your github SSH key</li> <li>Run the steps in Nix next</li> </ol>"},{"location":"Installation/#windows","title":"Windows","text":""},{"location":"Installation/#windows-subsystem-for-linux-wsl","title":"Windows Subsystem for Linux (WSL)","text":"<p>Windows Subsystem for Linux allows you to run a linux terminal on your windows machine. We specifically use WSL2 since it allows USB passthrough for flashing our microcontrollers. To install WSL follow this guide. Make sure to install WSL2 and not WSL1. It will take time to fully install it, but once installed you can open WSL and it will ask you to create a username and password.</p>"},{"location":"Installation/#usbipd","title":"USBIPD","text":"<p>In order to see a USB device in WSL, we need to pass access of a USB device from windows to WSL. You can do this through USBIPD. In an administrator Powershell terminal run:</p> <pre><code>winget install usbipd\n</code></pre> <p>Run the steps in Nix next</p>"},{"location":"Installation/#mac","title":"Mac","text":"<p>Run the steps in Nix</p>"},{"location":"Installation/#nix","title":"Nix","text":"<p>Nix is a package manger that lets you write out all the packages you want to install in a human readable format. This simplifies development since I can write out a list of dependencies needed to compile. Open Embedded-Sharepoint in your unix/linux (WSL for windows and MacOS for mac) environment, and run the following commands in the terminal:  Make the nix_install script runnable</p> <pre><code>chmod +x ./nix_install.sh\n</code></pre> <p>Run the script to install the needed nix dependencies.</p> <pre><code>sudo ./nix_install.sh\n</code></pre> <p>Enter the nix shell and download dependencies for Embedded-Sharepoint</p> <pre><code>nix develop\n</code></pre> <p>In this nix shell all the dependencies needed for Embedded-Sharepoint should be installed.  Anytime you open a new terminal and want to run compile/flash code you need to run nix develop to open the shell with Sharepoint's dependencies.  </p> <p>Test if installation is succesful by compiling a test </p> <pre><code>cd test\nmake TEST=blinky\n</code></pre>"}]}