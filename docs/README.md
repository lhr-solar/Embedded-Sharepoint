# Welcome to the Embedded Sharepoint Documentation

Welcome to the Embedded Sharepoint! Embedded-Sharepoint contains the shared embedded files to build and develop for our custom STM32 PCBs.

## Getting Started

### Cloning the repository
To clone the repository, run 
```sh
git clone git@github.com:lhr-solar/Embedded-Sharepoint.git --recursive
```
## Directory Structure

## Command Usage
The Makefile in the top level directory compiles all needed files for the STM32, it is not meant to be called directly, instead you must call it from a different Makefile

### Running tests
In the test/ directory there is a Makefile meant for just running test files. Every test file should end with `_test`  To run a test do:
``` sh
make TEST=[name of test file without _test_ and the .c extension] PROJECT_TARGET=[name of the STM32 you want to compile for]

# For example:
make TEST=blinky PROJECT_TARGET=stm32f413rht
# This compiles the blinky_test.c test for the STM32F413RHT
```

## Contributing
See our [Issues](https://github.com/lhr-solar/Embedded-Sharepoint/issues) to see what you can work on!  
Once you're ready for a review please open a pull request to merge into main. [Pull Requests explained](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/creating-a-pull-request) 

## WSL

### USB PassThrough

#### Pass USB Devices

In PowerShell administrator: 

    usbipd list
    usbipd bind --busid <busid>
    usbipd attach --wsl --busid <busid>


## Porting

A valid port of an STM requires three things:

1. A directory under stm/stm32f4xx or stm/stm32l4xx must be generated with the generic name of the microcontroller. This is typically stm32 followed by four characters specifying the series and line (stm32f413, stm32l431, etc.)
2. A linker script under the aforementioned directory. This can be autogenerated by STM32CubeMX or grabbed from the internet. The name should take the form of STM32*_FLASH.ld, and should include the full name of the processor (STM32F413RHTx_FLASH.ld, STM32L431CBTx_FLASH.ld, etc.)
3. A startup assembly file including the vector table and some basic handlers (most important being Reset_Handler). This can be autogenerated by STM32CubeMX or grabbed from the internet. The name should take the form of startup_stm32 followed by the four characters specifying the series and line and then xx (startup_stm32f413xx.s, startup_stm32l431xx.s)

The Makefile will expect this exact naming structure, so please ensure you've set it up properly. If everything goes to plan, you should be able to build with PROJECT_TARGET set to the full name of the port.
